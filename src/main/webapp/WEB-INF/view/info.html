<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="renderer" content="webkit">
    <title>监控信息</title>
    <link rel="stylesheet" href=" /css/pintuer.css">
    <link rel="stylesheet" href=" /css/admin.css">
    <script src=" /js/jquery.js"></script>
    <script src=" /js/pintuer.js"></script>
    <script src="/js/chart/highcharts.js"></script>
    <script src="/js/chart/modules/series-label.js"></script>
    <script src="/js/chart/modules/exporting.js"></script>
    <script src="/js/chart/modules/export-data.js"></script>

    <style type="text/css">
        #container {
            /*width: 1000px;*/
            height: 600px;
            margin: 0 auto
        }
    </style>
</head>
<body>
<div class="panel admin-panel">
    <div class="panel-head"> 当前时间:
        <div id="tStamp">###</div>
    </div>
    <div class="body-content">

        <div id="container" class="lineChart"></div>
        <div class="message1"></div>
        <script src=" /js/my.js"></script>
        <script type="text/javascript">
            $(function () {
                setInterval(function () {
                    getFormatDate("tStamp");
                }, 1000); //每隔一秒执行一次
            });

            Highcharts.setOptions({
                global: {
                    useUTC: false
                }
            });

            function activeLastPointToolip(chart) {
                var points = chart.series[0].points;
                chart.tooltip.refresh(points[points.length - 1]);
            }

            function updateDataByAdd(serie, chart) {
                var xdate, yval;
                activeLastPointToolip(chart);
                setInterval(function () {

                    $.ajax({
                        type: "POST",
                        url: "/monitor/getData",
                        cache: false,
                        contentType: false,    //不可缺
                        processData: false,    //不可缺;
                        dataType: "json",
                        success: function (suc) {
                            if (suc.code === 0) {
                                xdate = suc.data.datetime;
                                yval = suc.data.val;
                            }
                            console.log(suc.data.val);

                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("网络错误，请检查网络后重试" + XMLHttpRequest + textStatus + errorThrown);
                            return false;
                        }
                    });
                    // //这里向后台发送ajax请求，取到6组最新的数据点
                    // var x = (new Date()).getTime(), // 当前时间
                    //     y = Math.random()*100;          // 随机值
                    serie.addPoint([xdate, yval], true, true);
                    activeLastPointToolip(chart);
                }, 1000);
            }

            Highcharts.chart('container', {
                chart: {
                    type: 'spline',
                    marginRight: 10,
                    events: {
                        load: function () {
                            var chart = this;
                            var serie = this.series[0];
                            updateDataByAdd(serie, chart);
                        }
                    }
                },
                title: {
                    text: 'Multi-Channel Video Monitoring Real-Time Chart',
                    style: {
                        color: "#5F5F5F",
                        fontFamily: "SimHei",
                        fontSize: "24px",

                    }
                },
                xAxis: {
                    tickAmount: 50,
                    type: 'datetime',
                    tickPixelInterval: 50
                },
                yAxis: {
                    title: {
                        text: "侦测值"
                    }
                },
                tooltip: {
                    formatter: function () {
                        return '<b>' + this.series.name + '</b><br/>' +
                            Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>' +
                            Highcharts.numberFormat(this.y, 2);
                    }
                },
                legend: {
                    enabled: false
                },
                series: [
                    {
                    name: '随机数据',
                    data: (function () {
                        // 生成随机值
                        var data = [],
                            time = (new Date()).getTime(),
                            i;
                        for (i = -5; i <= 0; i++) {
                            data.push({
                                x: time + i * 1000,
                                y: Math.random()
                            });
                        }
                        return data;
                    }())
                    }

                ]
            });


        </script>
    </div>
</div>
</body>
</html>